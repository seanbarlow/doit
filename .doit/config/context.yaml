# Context Configuration
# ====================
# This file configures automatic context injection for doit commands.
# Project context (constitution, roadmap, specs) is automatically loaded
# and provided to AI agents when running doit commands.
#
# Location: .doit/config/context.yaml
# Documentation: https://github.com/your-org/doit/blob/main/docs/context-injection.md

# Schema version (required, must be 1)
version: 1

# ---------------------------------------------------------------------------
# Global Settings
# ---------------------------------------------------------------------------

# Master toggle - set to false to disable all context loading
enabled: true

# Maximum tokens per individual source
# Sources exceeding this limit will be intelligently truncated
# Default: 4000 (suitable for most AI model context windows)
max_tokens_per_source: 4000

# Maximum total tokens across all sources combined
# Must be >= max_tokens_per_source
# Default: 16000 (allows constitution + roadmap + spec + related specs)
total_max_tokens: 16000

# ---------------------------------------------------------------------------
# Source Configuration
# ---------------------------------------------------------------------------
# Each source has:
#   - enabled: Whether to load this source (default: true)
#   - priority: Loading order, lower = higher priority (default: varies)
#   - max_count: For multi-item sources like related_specs (default: 1)
#
# Available sources:
#   - constitution: Project principles from .doit/memory/constitution.md
#   - roadmap: Project roadmap from .doit/memory/roadmap.md
#   - current_spec: Feature spec based on current git branch
#   - related_specs: Similar specs found via content matching

# ---------------------------------------------------------------------------
# Summarization Configuration
# ---------------------------------------------------------------------------
# Controls how context is condensed when it approaches token limits.
# The AI coding agent (Claude, Copilot, etc.) receives guidance to prioritize.
#
# Two-tier approach:
#   1. Soft threshold: Adds guidance prompt for AI to focus on P1/P2 items
#   2. Hard limit: Truncates lowest-priority sources

summarization:
  # Enable roadmap summarization by priority (P1/P2 full, P3/P4 titles)
  enabled: true

  # Percentage of total_max_tokens that triggers guidance prompt
  # Default: 80.0 (adds guidance at 80% capacity)
  threshold_percentage: 80.0

  # If exceeding hard limit, truncate lower-priority sources
  fallback_to_truncation: true

  # Order of priority for preserving content during truncation
  # Sources not listed get lowest priority
  source_priorities:
    - constitution
    - roadmap
    - completed_roadmap
    - current_spec

  # Completed items matching configuration
  completed_items:
    # Maximum completed items to include in context
    max_count: 5
    # Minimum relevance score to include (0.0 - 1.0)
    min_relevance: 0.3

sources:
  # Project constitution - core principles and architecture decisions
  # Always loaded first as it provides essential context
  constitution:
    enabled: true
    priority: 1

  # Project roadmap - current priorities and upcoming work
  # Summarized by priority when summarization is enabled
  roadmap:
    enabled: true
    priority: 2

  # Completed roadmap items - historical context for the AI
  # Formatted for AI semantic understanding to identify relevant patterns
  completed_roadmap:
    enabled: true
    priority: 3
    # Maximum completed items to include
    max_count: 5

  # Current feature specification - detected from git branch
  # Example: branch "026-ai-context" loads specs/026-ai-context/spec.md
  current_spec:
    enabled: true
    priority: 4

  # Related specifications - found via content similarity
  # Provides context from similar features
  related_specs:
    enabled: true
    priority: 5
    # Maximum number of related specs to include
    max_count: 3

# ---------------------------------------------------------------------------
# Per-Command Overrides
# ---------------------------------------------------------------------------
# Override source settings for specific doit commands.
# Useful when certain commands need different context.
#
# Available commands: specit, planit, taskit, implementit, testit,
#                     reviewit, checkin, roadmapit, constitution, etc.

commands:
  # specit: Creating new feature specs
  # Disable related_specs since we're creating something new
  specit:
    sources:
      related_specs:
        enabled: false

  # roadmapit: Updating project roadmap
  # Disable current_spec as roadmap is project-wide
  roadmapit:
    sources:
      current_spec:
        enabled: false

  # constitution: Updating project principles
  # Only need current constitution for reference
  constitution:
    sources:
      roadmap:
        enabled: false
      current_spec:
        enabled: false
      related_specs:
        enabled: false

# ---------------------------------------------------------------------------
# Example: Minimal Configuration
# ---------------------------------------------------------------------------
# To use all defaults, your file can be as simple as:
#
#   version: 1
#   enabled: true
#
# The system will use sensible defaults for all other settings.

# ---------------------------------------------------------------------------
# Example: Disable Context Loading
# ---------------------------------------------------------------------------
# To completely disable context injection:
#
#   version: 1
#   enabled: false

# ---------------------------------------------------------------------------
# Example: Reduce Token Usage
# ---------------------------------------------------------------------------
# For smaller context windows or faster response times:
#
#   version: 1
#   max_tokens_per_source: 2000
#   total_max_tokens: 8000
#   sources:
#     related_specs:
#       max_count: 1
